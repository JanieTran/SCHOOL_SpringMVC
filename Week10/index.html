<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Student Management System</title>
    
    <!-- JQuery -->
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
    <!-- Bootstrap -->
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"> -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

    <script>
        $(document).ready(function() {
            // Ajax call to domain
            $.ajax({
                url: 'http://rmit.chickenkiller.com:8080/students',
                method: 'get',
                success: function(result) {
                    for (var i = 0; i < result.length; i++) {
                        var id = result[i]._id
                        var del = `<a href='#' onClick = "onDelete('${id}')">Delete</a>`
                        var edit = `<a href='#' onClick = "onEdit('${id}', '${result[i].name}', '${result[i].age}')">Edit</a>`
                        var row = 
                            `<tr id = '${id}'>
                                <td>${result[i].name}</td>
                                <td>${result[i].age}</td>
                                <td>${edit} | ${del}</td>
                            </tr>`
                        
                        $('#tblStudent tbody').append(row)
                    }
                }
            })
        })

        function onDelete(id) {
            if (confirm('Do you want to delete?')) {
                $.ajax({
                    url: 'http://rmit.chickenkiller.com:8080/students/' + id,
                    method: 'delete',
                    success: function(result) {
                        $('#' + id).remove()
                    }
                })
            }
        }

        function onSave() {
            var student = {name: $('#name').val(), age: $('#age').val()}
            if ($('#id').val() != '') {
                $.ajax ({
                    url: 'http://rmit.chickenkiller.com:8080/students/',
                    method: 'post',
                    contentType: 'application/json',
                    data: JSON.stringify(student),
                    success: function(result) {
                        console.log(result)
                        var id = result._id
                        var del = `<a href='#' onClick = "onDelete('${id}')">Delete</a>`
                        var row = 
                            `<tr id = '${id}'>
                                <td>${result.name}</td>
                                <td>${result.age}</td>
                                <td>${del}</td>
                            </tr>`
                        
                        $('#tblStudent tbody').append(row)
                        alert('Save successful')
                    }
                })
            } else {
                // HOMEWORK: Put method here
            }
            
        }

        function onEdit(id, name, age) {
            console.log("Edit")
            $('#id').val(id)
            $('#name').val(name)
            $('#age').val(age)
        }
    </script>

</head>
<body>
    <div class="container">
        <div class="jumbotron">
            <h1>Student Management System</h1>

            
        </div>

        <!-- A grey horizontal navbar that becomes vertical on small screens -->
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                <a class="navbar-brand" href="#">SMS</a>
                </div>
                <ul class="nav navbar-nav">
                <li class="active"><a href="#">Home</a></li>
                <li><a href="#">Students</a></li>
                <li><a href="#">Courses</a></li>
                <li><a href="#">Enrollment</a></li>
                </ul>
            </div>
        </nav>

        <div class="row">
            <div class="col-md-4">
                <div class="panel panel-default">
                    <div class="panel-heading">Student List</div>

                    <div class="panel panel-body">
                        <table class="table table-striped table-hover" id="tblStudent">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Age</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>

                            <tbody>
                                
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="col-md-8">
                <div class="panel panel-default">
                    <div class="panel-heading">Student Form</div>
                    <div class="panel-body">
                        <input type="hidden" id="id">

                        <label for="">Name: </label>
                        <input type="text" id="name" class="form-control"/>

                        <label for="">Age: </label>
                        <input type="text" id="age" class="form-control"/>

                        <button class="btn btn-default" onclick = 'onSave()'>Save</button>
                    </div>
                </div>
            </div>

        </div>
    </div>
</body>
</html>